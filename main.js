!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_active"},t=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""},r=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((r=>{r.addEventListener("submit",(e=>{e.preventDefault()})),((e,r)=>{const n=Array.from(e.querySelectorAll(r.inputSelector)),a=e.querySelector(r.submitButtonSelector);o(n,a,r),n.forEach((s=>{s.addEventListener("input",(()=>{((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,r,r.validationMessage,o)})(e,s,r),o(n,a,r)}))}))})(r,e)}))},o=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.setAttribute("disabled",""),t.classList.add(r.inactiveButtonClass)):(t.removeAttribute("disabled"),t.classList.remove(r.inactiveButtonClass))};r(e);const n=[],a=new class{constructor(){this._token="df848569-e5f8-493b-8228-42998e590ff1",this._baseUrl="https://around-api.en.tripleten-services.com/v1",this._headers={authorization:this._token,"Content-type":"application/json"}}getAppInfo(){return Promise.all([this.getAllCards()])}getAllCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}createCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}updateUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}},s=document.querySelector("#avatar-edit-modal"),c=s.querySelector(".modal__close-btn"),i=s.querySelector("#edit-avatar-link-input"),d=s.querySelector(".modal__submit-btn"),l=document.querySelector(".profile__edit-btn"),u=document.querySelector(".profile__add-btn"),m=document.querySelector(".profile__avatar"),_=document.querySelector("#edit-modal"),h=document.querySelector("#add-card-modal"),f=document.querySelector("#card-image-modal"),v=_.querySelector(".modal__close-btn"),y=h.querySelector(".modal__close-btn"),S=f.querySelector(".modal__close-btn"),b=_.querySelector("#modal__input"),k=_.querySelector("#modal__description"),p=document.querySelector(".profile__name"),E=document.querySelector(".profile__description"),q=document.querySelector(".modal__form"),L=document.querySelector("#add-card-form"),C=L.querySelector("#add-card-link-input"),g=L.querySelector("#add-card-name-input"),$=document.querySelector(".modal__image"),x=document.querySelector(".modal__image-footer-title"),j=document.querySelector("#delete-card-modal"),A=j.querySelector(".modal__close_delete-btn"),T=j.querySelector(".modal__confirm_cancel-btn"),U=j.querySelector(".modal__confirm_delete-btn"),P=document.querySelector(".cards__pics"),I=(P.querySelector(".card__footer-heart-btn"),e=>{e.target.classList.contains("modal_opened")&&w(e.target)});function D(e){e.classList.add("modal_opened"),document.body.addEventListener("click",I),document.addEventListener("keydown",N)}function w(e){e.classList.remove("modal_opened"),document.body.removeEventListener("click",I),document.removeEventListener("keydown",N)}function B(e){const t=document.querySelector("#card").content.querySelector(".card").cloneNode(!0);t.querySelector(".card__footer-title").textContent=e.name;const r=t.querySelector(".card__image");r.src=e.link,r.alt=e.name,r.id=e._id;const o=t.querySelector(".card__footer-heart-btn");return e.isLiked&&o.classList.add("card__footer-heart-btn-liked"),o.addEventListener("click",(()=>{!function(e,t){(!t.isLiked?a.likeCard(t._id):a.dislikeCard(t._id)).then((r=>{e.classList.toggle("card__footer-heart-btn-liked"),t.isLiked=r.isLiked})).catch(console.error)}(o,e)})),t.querySelector(".card__trash-btn").addEventListener("click",(()=>{var e,o;e=t,o=r.id,D(j),function(e,t){U.addEventListener("click",(()=>{U.innerText="Deleting...",setTimeout((()=>{const r=e.alt,o=n.findIndex((e=>e.name===r));n.toSpliced(1,o),e.remove(),a.deleteCard(t),w(j),U.innerText="Delete"}),1e3)}))}(e,o)})),r.addEventListener("click",(()=>{!function(e){const t=e.querySelector(".card__image"),r=e.querySelector(".card__footer-title");x.textContent=r.textContent,$.src="",D(f),$.src=t.src,$.alt=t.alt}(t)})),t}l.addEventListener("click",(()=>{var r,o;b.value=p.textContent,k.value=E.textContent,r=_,o=e,[b,k].forEach((e=>{t(r,e,o)})),D(_)})),u.addEventListener("click",(()=>{D(h)})),v.addEventListener("click",(()=>{w(_)})),c.addEventListener("click",(()=>{w(s)})),y.addEventListener("click",(()=>{w(h)})),S.addEventListener("click",(()=>{w(f)})),A.addEventListener("click",(()=>{w(j)})),T.addEventListener("click",(()=>{w(j)})),d.addEventListener("click",(e=>{!function(e){e.preventDefault(),a.updateUserAvatar(i.value).then((e=>{m.style.backgroundImage=`url(${e.avatar})`,w(s)})).catch(console.error)}(e)}));const N=e=>{"Escape"===e.key&&document.querySelectorAll(".modal_opened").forEach(w)};q.addEventListener("submit",(function(e){e.preventDefault();const t=_.querySelector(".modal__submit-btn");a.editUserInfo({name:b.value,about:k.value}).then((e=>{t.innerText="Saving...",setTimeout((()=>{p.textContent=e.name,E.textContent=e.about,w(_),t.innerText="Save"}),1500)})).catch(console.error)})),L.addEventListener("submit",(function(t){t.preventDefault();const r=h.querySelector(".modal__submit-btn");a.createCard({name:g.value,link:C.value}).then((t=>{const a={name:t.name,link:t.link,isLiked:t.isLiked,_id:t._id,owner:t.owner};""!==g.value&&""!==C.value&&(r.innerText="Saving...",setTimeout((()=>{n.unshift(a),P.prepend(B(a)),w(h),r.innerText="Save"}),1e3)),g.value="",C.value="";const s=Array.from(h.querySelectorAll(".modal__input"));o(s,r,e)})).catch(console.error)})),a.getAppInfo().then((e=>{let[t]=e;t.forEach((e=>{P.append(B(e))}))})).catch(console.error),a.getUserInfo().then((e=>{p.textContent=e.name,E.textContent=e.about,m.id=e._id,m.style.backgroundImage=`url(${e.avatar})`,m.addEventListener("click",(()=>{D(s)}))})).catch(console.error),r(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQU8sTUFBTUEsRUFBVyxDQUN0QkMsYUFBYyxlQUNkQyxjQUFlLGdCQUNmQyxxQkFBc0IscUJBQ3RCQyxvQkFBcUIsNkJBQ3JCQyxnQkFBaUIsMEJBQ2pCQyxXQUFZLDZCQVdSQyxFQUFpQkEsQ0FBQ0MsRUFBYUMsRUFBY0MsS0FDakQsTUFBTUMsRUFBZUgsRUFBWUksY0FBYyxJQUFJSCxFQUFhSSxZQUNoRUosRUFBYUssVUFBVUMsT0FBT0wsRUFBT0wsaUJBQ3JDTSxFQUFhRyxVQUFVQyxPQUFPTCxFQUFPSixZQUNyQ0ssRUFBYUssWUFBYyxFQUFFLEVBK0JsQkMsRUFBb0JQLElBQ2RRLE1BQU1DLEtBQUtDLFNBQVNDLGlCQUFpQlgsRUFBT1QsZUFFcERxQixTQUFTZCxJQUNoQkEsRUFBWWUsaUJBQWlCLFVBQVdDLElBQ3RDQSxFQUFJQyxnQkFBZ0IsSUFwQkFDLEVBQUNsQixFQUFhRSxLQUN0QyxNQUFNaUIsRUFBWVQsTUFBTUMsS0FDdEJYLEVBQVlhLGlCQUFpQlgsRUFBT1IsZ0JBRWhDMEIsRUFBZ0JwQixFQUFZSSxjQUFjRixFQUFPUCxzQkFDdkQwQixFQUFrQkYsRUFBV0MsRUFBZWxCLEdBRTVDaUIsRUFBVUwsU0FBU2IsSUFDakJBLEVBQWFjLGlCQUFpQixTQUFTLEtBckJoQk8sRUFBQ3RCLEVBQWFDLEVBQWNDLEtBQ2hERCxFQUFhc0IsU0FBU0MsTUFRekJ6QixFQUFlQyxFQUFhQyxFQUFjQyxHQXhCdkJ1QixFQUFDekIsRUFBYUMsRUFBY3lCLEVBQWN4QixLQUMvRCxNQUFNQyxFQUFlSCxFQUFZSSxjQUFjLElBQUlILEVBQWFJLFlBRWhFSixFQUFhSyxVQUFVcUIsSUFBSXpCLEVBQU9MLGlCQUNsQ00sRUFBYUssWUFBY2tCLEVBQzNCdkIsRUFBYUcsVUFBVXFCLElBQUl6QixFQUFPSixXQUFXLEVBWTNDMkIsQ0FDRXpCLEVBQ0FDLEVBQ0FBLEVBQWEyQixrQkFDYjFCLEVBSUosRUFZSW9CLENBQW1CdEIsRUFBYUMsRUFBY0MsR0FDOUNtQixFQUFrQkYsRUFBV0MsRUFBZWxCLEVBQU8sR0FDbkQsR0FDRixFQVdBZ0IsQ0FBa0JsQixFQUFhRSxFQUFPLEdBQ3RDLEVBU1NtQixFQUFvQkEsQ0FBQ0YsRUFBV0MsRUFBZWxCLEtBTm5DaUIsSUFDaEJBLEVBQVVVLE1BQU01QixJQUNiQSxFQUFhc0IsU0FBU0MsUUFLNUJNLENBQWdCWCxJQUNsQkMsRUFBY1csYUFBYSxXQUFZLElBQ3ZDWCxFQUFjZCxVQUFVcUIsSUFBSXpCLEVBQU9OLHVCQUVuQ3dCLEVBQWNZLGdCQUFnQixZQUM5QlosRUFBY2QsVUFBVUMsT0FBT0wsRUFBT04scUJBQ3hDLEVBUUZhLEVBQWlCakIsR0M5Q2pCLE1BQU15QyxFQUFlLEdBQ2ZDLEVBQU0sSUN4Q0wsTUFDTEMsV0FBQUEsR0FDRUMsS0FBS0MsT0FBU0MsdUNBQ2RGLEtBQUtHLFNBQVcsa0RBQ2hCSCxLQUFLSSxTQUFXLENBQ2RDLGNBQWVMLEtBQUtDLE9BQ3BCLGVBQWdCLG1CQUVwQixDQUVBSyxVQUFBQSxHQUVFLE9BQU9DLFFBQVFDLElBQUksQ0FBQ1IsS0FBS1MsZUFDM0IsQ0FFQUEsV0FBQUEsR0FDRSxPQUFPQyxNQUFNLEdBQUdWLEtBQUtHLGlCQUFrQixDQUNyQ1EsT0FBUSxNQUNSQyxRQUFTWixLQUFLSSxXQUNiUyxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFDLFVBQUFBLENBQVVDLEdBQWlCLElBQWhCLEtBQUVDLEVBQUksS0FBRUMsR0FBTUYsRUFDdkIsT0FBT1YsTUFBTSxHQUFHVixLQUFLRyxpQkFBa0IsQ0FDckNRLE9BQVEsT0FDUkMsUUFBU1osS0FBS0ksU0FDZG1CLEtBQU1DLEtBQUtDLFVBQVUsQ0FBRUosT0FBTUMsV0FDNUJULE1BQU1DLElBQ1AsR0FBSUEsRUFBSUMsR0FDTixPQUFPRCxFQUFJRSxPQUViVCxRQUFRVSxPQUFPLFVBQVVILEVBQUlJLFNBQVMsR0FFMUMsQ0FFQVEsVUFBQUEsQ0FBV0MsR0FDVCxPQUFPakIsTUFBTSxHQUFHVixLQUFLRyxrQkFBa0J3QixJQUFVLENBQy9DaEIsT0FBUSxTQUNSQyxRQUFTWixLQUFLSSxXQUNiUyxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFVLFFBQUFBLENBQVNELEdBQ1AsT0FBT2pCLE1BQU0sR0FBR1YsS0FBS0csa0JBQWtCd0IsVUFBZ0IsQ0FDckRoQixPQUFRLE1BQ1JDLFFBQVNaLEtBQUtJLFdBQ2JTLE1BQU1DLElBQ1AsR0FBSUEsRUFBSUMsR0FDTixPQUFPRCxFQUFJRSxPQUdiVCxRQUFRVSxPQUFPLFVBQVVILEVBQUlJLFNBQVMsR0FFMUMsQ0FFQVcsV0FBQUEsQ0FBWUYsR0FDVixPQUFPakIsTUFBTSxHQUFHVixLQUFLRyxrQkFBa0J3QixVQUFnQixDQUNyRGhCLE9BQVEsU0FDUkMsUUFBU1osS0FBS0ksV0FDYlMsTUFBTUMsSUFDUCxHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BR2JULFFBQVFVLE9BQU8sVUFBVUgsRUFBSUksU0FBUyxHQUUxQyxDQUVBWSxXQUFBQSxHQUNFLE9BQU9wQixNQUFNLEdBQUdWLEtBQUtHLG9CQUFxQixDQUN4Q1EsT0FBUSxNQUNSQyxRQUFTWixLQUFLSSxXQUNiUyxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FHYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFhLFlBQUFBLENBQVlDLEdBQWtCLElBQWpCLEtBQUVYLEVBQUksTUFBRVksR0FBT0QsRUFDMUIsT0FBT3RCLE1BQU0sR0FBR1YsS0FBS0csb0JBQXFCLENBQ3hDUSxPQUFRLFFBQ1JDLFFBQVNaLEtBQUtJLFNBQ2RtQixLQUFNQyxLQUFLQyxVQUFVLENBQUVKLE9BQU1ZLFlBQzVCcEIsTUFBTUMsSUFDUCxHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BR2JULFFBQVFVLE9BQU8sVUFBVUgsRUFBSUksU0FBUyxHQUUxQyxDQUVBZ0IsZ0JBQUFBLENBQWlCQyxHQUNmLE9BQU96QixNQUFNLEdBQUdWLEtBQUtHLDJCQUE0QixDQUMvQ1EsT0FBUSxRQUNSQyxRQUFTWixLQUFLSSxTQUNkbUIsS0FBTUMsS0FBS0MsVUFBVSxDQUFFVSxhQUN0QnRCLE1BQU1DLElBQ1AsR0FBSUEsRUFBSUMsR0FDTixPQUFPRCxFQUFJRSxPQUdiVCxRQUFRVSxPQUFPLFVBQVVILEVBQUlJLFNBQVMsR0FFMUMsR0QzRUlrQixFQUF5QjVELFNBQVNSLGNBQWMsc0JBQ2hEcUUsRUFDSkQsRUFBdUJwRSxjQUFjLHFCQUNqQ3NFLEVBQXFCRixFQUF1QnBFLGNBQ2hELDJCQUVJdUUsRUFDSkgsRUFBdUJwRSxjQUFjLHNCQUVqQ3dFLEVBQW9CaEUsU0FBU1IsY0FBYyxzQkFDM0N5RSxFQUFnQmpFLFNBQVNSLGNBQWMscUJBQ3ZDMEUsRUFBZWxFLFNBQVNSLGNBQWMsb0JBQ3RDMkUsRUFBbUJuRSxTQUFTUixjQUFjLGVBQzFDNEUsRUFBZXBFLFNBQVNSLGNBQWMsbUJBQ3RDNkUsRUFBaUJyRSxTQUFTUixjQUFjLHFCQUN4QzhFLEVBQXFCSCxFQUFpQjNFLGNBQWMscUJBQ3BEK0UsRUFBdUJILEVBQWE1RSxjQUFjLHFCQUNsRGdGLEVBQXVCSCxFQUFlN0UsY0FBYyxxQkFFcERpRixFQUFtQk4sRUFBaUIzRSxjQUFjLGlCQUNsRGtGLEVBQTBCUCxFQUFpQjNFLGNBQy9DLHVCQUdJbUYsRUFBa0IzRSxTQUFTUixjQUFjLGtCQUN6Q29GLEVBQXlCNUUsU0FBU1IsY0FBYyx5QkFDaERxRixFQUFjN0UsU0FBU1IsY0FBYyxnQkFDckNzRixFQUFlOUUsU0FBU1IsY0FBYyxrQkFFdEN1RixFQUFtQkQsRUFBYXRGLGNBQWMsd0JBQzlDd0YsRUFBc0JGLEVBQWF0RixjQUFjLHdCQUNqRHlGLEVBQWFqRixTQUFTUixjQUFjLGlCQUNwQzBGLEVBQXFCbEYsU0FBU1IsY0FBYyw4QkFFNUMyRixFQUFxQm5GLFNBQVNSLGNBQWMsc0JBQzVDNEYsRUFBeUJELEVBQW1CM0YsY0FDaEQsNEJBRUk2RixFQUEwQkYsRUFBbUIzRixjQUNqRCw4QkFFSThGLEVBQXdCSCxFQUFtQjNGLGNBQy9DLDhCQUdJK0YsRUFBdUJ2RixTQUFTUixjQUFjLGdCQU05Q2dHLEdBSmtCRCxFQUFxQi9GLGNBQzNDLDJCQUcwQmlHLElBQ3RCQSxFQUFNQyxPQUFPaEcsVUFBVWlHLFNBQVMsaUJBQ2xDQyxFQUFXSCxFQUFNQyxPQUNuQixHQUdGLFNBQVNHLEVBQVVDLEdBQ2pCQSxFQUFNcEcsVUFBVXFCLElBQUksZ0JBQ3BCZixTQUFTK0MsS0FBSzVDLGlCQUFpQixRQUFTcUYsR0FDeEN4RixTQUFTRyxpQkFBaUIsVUFBVzRGLEVBQ3ZDLENBRUEsU0FBU0gsRUFBV0UsR0FDbEJBLEVBQU1wRyxVQUFVQyxPQUFPLGdCQUN2QkssU0FBUytDLEtBQUtpRCxvQkFBb0IsUUFBU1IsR0FDM0N4RixTQUFTZ0csb0JBQW9CLFVBQVdELEVBQzFDLENBMkVBLFNBQVNFLEVBQWVDLEdBQ3RCLE1BQU1DLEVBQWNuRyxTQUNqQlIsY0FBYyxTQUNkNEcsUUFBUTVHLGNBQWMsU0FDdEI2RyxXQUFVLEdBRWJGLEVBQVkzRyxjQUFjLHVCQUF1QkksWUFBY3NHLEVBQUtyRCxLQUVwRSxNQUFNeUQsRUFBWUgsRUFBWTNHLGNBQWMsZ0JBRTVDOEcsRUFBVUMsSUFBTUwsRUFBS3BELEtBQ3JCd0QsRUFBVUUsSUFBTU4sRUFBS3JELEtBRXJCeUQsRUFBVTdHLEdBQUt5RyxFQUFLTyxJQUVwQixNQUFNQyxFQUFlUCxFQUFZM0csY0FBYywyQkFvQi9DLE9BbEJJMEcsRUFBS1MsU0FDUEQsRUFBYWhILFVBQVVxQixJQUFJLGdDQUc3QjJGLEVBQWF2RyxpQkFBaUIsU0FBUyxNQWdCekMsU0FBMEJ5RyxFQUFRVixLQUNMQSxFQUFLUyxRQUU1QnJGLEVBQUk4QixTQUFTOEMsRUFBS08sS0FDbEJuRixFQUFJK0IsWUFBWTZDLEVBQUtPLE1BR3RCcEUsTUFBTXdFLElBQ0xELEVBQU9sSCxVQUFVb0gsT0FBTyxnQ0FFeEJaLEVBQUtTLFFBQVVFLEVBQVlGLE9BQU8sSUFFbkNJLE1BQU1DLFFBQVFDLE1BQ25CLENBNUJJQyxDQUFpQlIsRUFBY1IsRUFBSyxJQUdkQyxFQUFZM0csY0FBYyxvQkFFbENXLGlCQUFpQixTQUFTLEtBeUI1QyxJQUE0QnlHLEVBQVF6RCxFQUFSeUQsRUF4QkxULEVBd0JhaEQsRUF4QkFtRCxFQUFVN0csR0F5QjVDb0csRUFBVVYsR0FJWixTQUEyQnlCLEVBQVF6RCxHQUNqQ21DLEVBQXNCbkYsaUJBQWlCLFNBQVMsS0FDOUNtRixFQUFzQjZCLFVBQVksY0FDbENDLFlBQVcsS0FDVCxNQUFNQyxFQUFXVCxFQUFPSixJQUNsQmMsRUFBUWpHLEVBQWFrRyxXQUFXQyxHQUFTQSxFQUFLM0UsT0FBU3dFLElBQzdEaEcsRUFBYW9HLFVBQVUsRUFBR0gsR0FDMUJWLEVBQU9qSCxTQUVQMkIsRUFBSTRCLFdBQVdDLEdBQ2Z5QyxFQUFXVCxHQUNYRyxFQUFzQjZCLFVBQVksUUFBUSxHQUN6QyxJQUFLLEdBRVosQ0FqQkVPLENBQWtCZCxFQUFRekQsRUExQnFCLElBRy9DbUQsRUFBVW5HLGlCQUFpQixTQUFTLE1BMEN0QyxTQUF3QnlHLEdBQ3RCLE1BQU1OLEVBQVlNLEVBQU9wSCxjQUFjLGdCQUNqQ21JLEVBQWVmLEVBQU9wSCxjQUFjLHVCQUUxQzBGLEVBQW1CdEYsWUFBYytILEVBQWEvSCxZQUU5Q3FGLEVBQVdzQixJQUFNLEdBRWpCVixFQUFVeEIsR0FFVlksRUFBV3NCLElBQU1ELEVBQVVDLElBQzNCdEIsRUFBV3VCLElBQU1GLEVBQVVFLEdBQzdCLENBckRJb0IsQ0FBZXpCLEVBQVksSUFHdEJBLENBQ1QsQ0FtREFuQyxFQUFrQjdELGlCQUFpQixTQUFTLEtEL0xiMEgsSUFBQ3pJLEVBQXdCRSxFQ2dNdERtRixFQUFpQnFELE1BQVFuRCxFQUFnQi9FLFlBQ3pDOEUsRUFBd0JvRCxNQUFRbEQsRUFBdUJoRixZRGpNekJSLEVDbU01QitFLEVEbk1vRDdFLEVDcU1wRFYsRUFEQSxDQUFDNkYsRUFBa0JDLEdEbk1YeEUsU0FBUzZILElBQ2pCNUksRUFBZUMsRUFBYTJJLEVBQU96SSxFQUFPLElDcU01Q3VHLEVBQVUxQixFQUFpQixJQUc3QkYsRUFBYzlELGlCQUFpQixTQUFTLEtBQ3RDMEYsRUFBVXpCLEVBQWEsSUFHekJFLEVBQW1CbkUsaUJBQWlCLFNBQVMsS0FDM0N5RixFQUFXekIsRUFBaUIsSUFHOUJOLEVBQXlCMUQsaUJBQWlCLFNBQVMsS0FDakR5RixFQUFXaEMsRUFBdUIsSUFHcENXLEVBQXFCcEUsaUJBQWlCLFNBQVMsS0FDN0N5RixFQUFXeEIsRUFBYSxJQUcxQkksRUFBcUJyRSxpQkFBaUIsU0FBUyxLQUM3Q3lGLEVBQVd2QixFQUFlLElBRzVCZSxFQUF1QmpGLGlCQUFpQixTQUFTLEtBQy9DeUYsRUFBV1QsRUFBbUIsSUFHaENFLEVBQXdCbEYsaUJBQWlCLFNBQVMsS0FDaER5RixFQUFXVCxFQUFtQixJQUdoQ3BCLEVBQXdCNUQsaUJBQWlCLFNBQVVDLEtBakxuRCxTQUFpQ0EsR0FDL0JBLEVBQUlDLGlCQUVKaUIsRUFDR29DLGlCQUFpQkksRUFBbUJnRSxPQUNwQ3pGLE1BQU02RCxJQUNMaEMsRUFBYThELE1BQU1DLGdCQUFrQixPQUFPL0IsRUFBS3ZDLFVBQ2pEaUMsRUFBV2hDLEVBQXVCLElBRW5DbUQsTUFBTUMsUUFBUUMsTUFDbkIsQ0F3S0VpQixDQUF3QjlILEVBQUksSUFHOUIsTUFBTTJGLEVBQTRCTixJQUNkLFdBQWRBLEVBQU0wQyxLQUNXbkksU0FBU0MsaUJBQWlCLGlCQUNsQ0MsUUFBUTBGLEVBQ3JCLEVBR0ZmLEVBQVkxRSxpQkFBaUIsVUFsTjdCLFNBQWlDQyxHQUMvQkEsRUFBSUMsaUJBQ0osTUFBTStILEVBQ0pqRSxFQUFpQjNFLGNBQWMsc0JBQ2pDOEIsRUFDR2lDLGFBQWEsQ0FDWlYsS0FBTTRCLEVBQWlCcUQsTUFDdkJyRSxNQUFPaUIsRUFBd0JvRCxRQUVoQ3pGLE1BQU02RCxJQUNMa0MsRUFBNkJqQixVQUFZLFlBQ3pDQyxZQUFXLEtBQ1R6QyxFQUFnQi9FLFlBQWNzRyxFQUFLckQsS0FDbkMrQixFQUF1QmhGLFlBQWNzRyxFQUFLekMsTUFFMUNtQyxFQUFXekIsR0FDWGlFLEVBQTZCakIsVUFBWSxNQUFNLEdBQzlDLEtBQUssSUFFVEosTUFBTUMsUUFBUUMsTUFDbkIsSUErTEFuQyxFQUFhM0UsaUJBQWlCLFVBakw5QixTQUE4QkMsR0FDNUJBLEVBQUlDLGlCQUNKLE1BQU1HLEVBQWdCNEQsRUFBYTVFLGNBQWMsc0JBRWpEOEIsRUFDR3FCLFdBQVcsQ0FDVkUsS0FBTW1DLEVBQW9COEMsTUFDMUJoRixLQUFNaUMsRUFBaUIrQyxRQUV4QnpGLE1BQU02RCxJQUNMLE1BQU1tQyxFQUFVLENBQ2R4RixLQUFNcUQsRUFBS3JELEtBQ1hDLEtBQU1vRCxFQUFLcEQsS0FDWDZELFFBQVNULEVBQUtTLFFBQ2RGLElBQUtQLEVBQUtPLElBQ1Y2QixNQUFPcEMsRUFBS29DLE9BRW9CLEtBQTlCdEQsRUFBb0I4QyxPQUEyQyxLQUEzQi9DLEVBQWlCK0MsUUFDdkR0SCxFQUFjMkcsVUFBWSxZQUMxQkMsWUFBVyxLQUNUL0YsRUFBYWtILFFBQVFGLEdBRXJCOUMsRUFBcUJpRCxRQUFRdkMsRUFBZW9DLElBQzVDekMsRUFBV3hCLEdBQ1g1RCxFQUFjMkcsVUFBWSxNQUFNLEdBQy9CLE1BRUxuQyxFQUFvQjhDLE1BQVEsR0FDNUIvQyxFQUFpQitDLE1BQVEsR0FFekIsTUFBTXZILEVBQVlULE1BQU1DLEtBQ3RCcUUsRUFBYW5FLGlCQUFpQixrQkFHaENRLEVBQWtCRixFQUFXQyxFQUFlNUIsRUFBUyxJQUV0RG1JLE1BQU1DLFFBQVFDLE1BQ25CLElBK0lBM0YsRUFDR1EsYUFDQU8sTUFBS08sSUFBYSxJQUFYNkYsR0FBTTdGLEVBQ1o2RixFQUFNdkksU0FBU3dJLElBQ2JuRCxFQUFxQm9ELE9BQU8xQyxFQUFleUMsR0FBTSxHQUNqRCxJQUVIM0IsTUFBTUMsUUFBUUMsT0FFakIzRixFQUNHZ0MsY0FDQWpCLE1BQU11RyxJQUNMakUsRUFBZ0IvRSxZQUFjZ0osRUFBUy9GLEtBQ3ZDK0IsRUFBdUJoRixZQUFjZ0osRUFBU25GLE1BQzlDUyxFQUFhekUsR0FBS21KLEVBQVNuQyxJQUUzQnZDLEVBQWE4RCxNQUFNQyxnQkFBa0IsT0FBT1csRUFBU2pGLFVBRXJETyxFQUFhL0QsaUJBQWlCLFNBQVMsS0FDckMwRixFQUFVakMsRUFBdUIsR0FDakMsSUFFSG1ELE1BQU1DLFFBQVFDLE9BRWpCcEgsRUFBaUJqQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2luYWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl9hY3RpdmVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcblxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuZXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQ2xhc3MpO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgZm9ybUVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICBjb25maWdcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcblxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJpbXBvcnQgeyBBcGkgfSBmcm9tIFwiLi4vdXRpbHMvYXBpLmpzXCI7XG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgc2V0dGluZ3MsXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgdG9nZ2xlQnV0dG9uU3RhdGUsXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcblxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICB7XG4vLyAgICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBCcmlkZ2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyBdO1xuY29uc3QgaW5pdGlhbENhcmRzID0gW107XG5jb25zdCBhcGkgPSBuZXcgQXBpKCk7XG5cbmNvbnN0IHByb2ZpbGVBdmF0YXJFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1lZGl0LW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckNsb3NlQnV0dG9uID1cbiAgcHJvZmlsZUF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBwcm9maWxlQXZhdGFySW5wdXQgPSBwcm9maWxlQXZhdGFyRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2VkaXQtYXZhdGFyLWxpbmstaW5wdXRcIlxuKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJTYXZlQnV0dG9uID1cbiAgcHJvZmlsZUF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBhZGRQb3N0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xuY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LW1vZGFsXCIpO1xuY29uc3QgYWRkUG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGltYWdlWm9vbU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltYWdlLW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUNsb3NlQnV0dG9uID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBjbG9zZVBvc3RNb2RhbEJ1dHRvbiA9IGFkZFBvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBjbG9zZVpvb21Nb2RhbEJ1dHRvbiA9IGltYWdlWm9vbU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcblxuY29uc3QgcHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNtb2RhbF9faW5wdXRcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjbW9kYWxfX2Rlc2NyaXB0aW9uXCJcbik7XG5cbmNvbnN0IHByb2ZpbGVVc2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVVc2VyRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgcHJvZmlsZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYWRkTW9kYWxGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1mb3JtXCIpO1xuXG5jb25zdCBhZGRNb2RhbEZvcm1MaW5rID0gYWRkTW9kYWxGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiKTtcbmNvbnN0IGFkZE1vZGFsRm9ybUNhcHRpb24gPSBhZGRNb2RhbEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1uYW1lLWlucHV0XCIpO1xuY29uc3QgbW9kYWxJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgbW9kYWxGb290ZXJDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtZm9vdGVyLXRpdGxlXCIpO1xuXG5jb25zdCBtb2RhbENvbmZpcm1EZWxldGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xuY29uc3QgY2xvc2VEZWxldGVNb2RhbEJ1dHRvbiA9IG1vZGFsQ29uZmlybURlbGV0ZS5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2VfZGVsZXRlLWJ0blwiXG4pO1xuY29uc3QgY2FuY2VsRGVsZXRlTW9kYWxCdXR0b24gPSBtb2RhbENvbmZpcm1EZWxldGUucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2NvbmZpcm1fY2FuY2VsLWJ0blwiXG4pO1xuY29uc3QgbW9kYWxDb25maXJtRGVsZXRlQnRuID0gbW9kYWxDb25maXJtRGVsZXRlLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jb25maXJtX2RlbGV0ZS1idG5cIlxuKTtcblxuY29uc3QgY2FyZENvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19waWNzXCIpO1xuXG5jb25zdCBjYXJkSGVhcnRCdXR0b24gPSBjYXJkQ29udGVudENvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFxuICBcIi5jYXJkX19mb290ZXItaGVhcnQtYnRuXCJcbik7XG5cbmNvbnN0IGNsb3NlTW9kYWxMaXN0ZW5lciA9IChldmVudCkgPT4ge1xuICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xuICAgIGNsb3NlTW9kYWwoZXZlbnQudGFyZ2V0KTtcbiAgfVxufTtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlTW9kYWxMaXN0ZW5lcik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2NhcGVMaXN0ZW5lcik7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xvc2VNb2RhbExpc3RlbmVyKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbEVzY2FwZUxpc3RlbmVyKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBwcm9maWxlRGVzY3JpcHRpb25TYXZlQnV0dG9uID1cbiAgICBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25TYXZlQnV0dG9uLmlubmVyVGV4dCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgcHJvZmlsZVVzZXJOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgICBwcm9maWxlVXNlckRlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcblxuICAgICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgICAgICBwcm9maWxlRGVzY3JpcHRpb25TYXZlQnV0dG9uLmlubmVyVGV4dCA9IFwiU2F2ZVwiO1xuICAgICAgfSwgMTUwMCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0QXZhdGFyKGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBhcGlcbiAgICAudXBkYXRlVXNlckF2YXRhcihwcm9maWxlQXZhdGFySW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVJbWFnZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7ZGF0YS5hdmF0YXJ9KWA7XG4gICAgICBjbG9zZU1vZGFsKHByb2ZpbGVBdmF0YXJFZGl0TW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQb3N0Rm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBhZGRQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcblxuICBhcGlcbiAgICAuY3JlYXRlQ2FyZCh7XG4gICAgICBuYW1lOiBhZGRNb2RhbEZvcm1DYXB0aW9uLnZhbHVlLFxuICAgICAgbGluazogYWRkTW9kYWxGb3JtTGluay52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zdCBuZXdDYXJkID0ge1xuICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgICAgIGxpbms6IGRhdGEubGluayxcbiAgICAgICAgaXNMaWtlZDogZGF0YS5pc0xpa2VkLFxuICAgICAgICBfaWQ6IGRhdGEuX2lkLFxuICAgICAgICBvd25lcjogZGF0YS5vd25lcixcbiAgICAgIH07XG4gICAgICBpZiAoYWRkTW9kYWxGb3JtQ2FwdGlvbi52YWx1ZSAhPT0gXCJcIiAmJiBhZGRNb2RhbEZvcm1MaW5rLnZhbHVlICE9PSBcIlwiKSB7XG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuaW5uZXJUZXh0ID0gXCJTYXZpbmcuLi5cIjtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgaW5pdGlhbENhcmRzLnVuc2hpZnQobmV3Q2FyZCk7XG5cbiAgICAgICAgICBjYXJkQ29udGVudENvbnRhaW5lci5wcmVwZW5kKGdldENhcmRFbGVtZW50KG5ld0NhcmQpKTtcbiAgICAgICAgICBjbG9zZU1vZGFsKGFkZFBvc3RNb2RhbCk7XG4gICAgICAgICAgYnV0dG9uRWxlbWVudC5pbm5lclRleHQgPSBcIlNhdmVcIjtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgICB9XG4gICAgICBhZGRNb2RhbEZvcm1DYXB0aW9uLnZhbHVlID0gXCJcIjtcbiAgICAgIGFkZE1vZGFsRm9ybUxpbmsudmFsdWUgPSBcIlwiO1xuXG4gICAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgICBhZGRQb3N0TW9kYWwucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIilcbiAgICAgICk7XG5cbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIiNjYXJkXCIpXG4gICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2Zvb3Rlci10aXRsZVwiKS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuXG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuICBjYXJkSW1hZ2UuaWQgPSBkYXRhLl9pZDtcblxuICBjb25zdCBjYXJkSGVhcnRCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2Zvb3Rlci1oZWFydC1idG5cIik7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRIZWFydEJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fZm9vdGVyLWhlYXJ0LWJ0bi1saWtlZFwiKTtcbiAgfVxuXG4gIGNhcmRIZWFydEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhhbmRsZUxpa2VCdXR0b24oY2FyZEhlYXJ0QnRuLCBkYXRhKTtcbiAgfSk7XG5cbiAgY29uc3QgY2FyZFRyYXNoQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190cmFzaC1idG5cIik7XG5cbiAgY2FyZFRyYXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGFuZGxlRGVsZXRlQnV0dG9uKGNhcmRFbGVtZW50LCBjYXJkSW1hZ2UuaWQpO1xuICB9KTtcblxuICBjYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBvcGVuSW1hZ2VNb2RhbChjYXJkRWxlbWVudCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cbmZ1bmN0aW9uIGhhbmRsZUxpa2VCdXR0b24oY2FyZEVsLCBkYXRhKSB7XG4gIGNvbnN0IHVwZGF0ZWRMaWtlZFN0YXRlID0gIWRhdGEuaXNMaWtlZDtcbiAgY29uc3QgYXBpQ2FsbCA9IHVwZGF0ZWRMaWtlZFN0YXRlXG4gICAgPyBhcGkubGlrZUNhcmQoZGF0YS5faWQpXG4gICAgOiBhcGkuZGlzbGlrZUNhcmQoZGF0YS5faWQpO1xuXG4gIHJldHVybiBhcGlDYWxsXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICBjYXJkRWwuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2Zvb3Rlci1oZWFydC1idG4tbGlrZWRcIik7XG5cbiAgICAgIGRhdGEuaXNMaWtlZCA9IHVwZGF0ZWRDYXJkLmlzTGlrZWQ7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUJ1dHRvbihjYXJkRWwsIGNhcmRJZCkge1xuICBvcGVuTW9kYWwobW9kYWxDb25maXJtRGVsZXRlKTtcbiAgY29uZmlybUNhcmREZWxldGUoY2FyZEVsLCBjYXJkSWQpO1xufVxuXG5mdW5jdGlvbiBjb25maXJtQ2FyZERlbGV0ZShjYXJkRWwsIGNhcmRJZCkge1xuICBtb2RhbENvbmZpcm1EZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBtb2RhbENvbmZpcm1EZWxldGVCdG4uaW5uZXJUZXh0ID0gXCJEZWxldGluZy4uLlwiO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgY2FyZE5hbWUgPSBjYXJkRWwuYWx0O1xuICAgICAgY29uc3QgaW5kZXggPSBpbml0aWFsQ2FyZHMuZmluZEluZGV4KChjYXJkKSA9PiBjYXJkLm5hbWUgPT09IGNhcmROYW1lKTtcbiAgICAgIGluaXRpYWxDYXJkcy50b1NwbGljZWQoMSwgaW5kZXgpO1xuICAgICAgY2FyZEVsLnJlbW92ZSgpO1xuXG4gICAgICBhcGkuZGVsZXRlQ2FyZChjYXJkSWQpO1xuICAgICAgY2xvc2VNb2RhbChtb2RhbENvbmZpcm1EZWxldGUpO1xuICAgICAgbW9kYWxDb25maXJtRGVsZXRlQnRuLmlubmVyVGV4dCA9IFwiRGVsZXRlXCI7XG4gICAgfSwgMTAwMCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBvcGVuSW1hZ2VNb2RhbChjYXJkRWwpIHtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IG1vZGFsQ2FwdGlvbiA9IGNhcmRFbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2Zvb3Rlci10aXRsZVwiKTtcblxuICBtb2RhbEZvb3RlckNhcHRpb24udGV4dENvbnRlbnQgPSBtb2RhbENhcHRpb24udGV4dENvbnRlbnQ7XG5cbiAgbW9kYWxJbWFnZS5zcmMgPSBcIlwiO1xuXG4gIG9wZW5Nb2RhbChpbWFnZVpvb21Nb2RhbCk7XG5cbiAgbW9kYWxJbWFnZS5zcmMgPSBjYXJkSW1hZ2Uuc3JjO1xuICBtb2RhbEltYWdlLmFsdCA9IGNhcmRJbWFnZS5hbHQ7XG59XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlVXNlck5hbWUudGV4dENvbnRlbnQ7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZVVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlTW9kYWwsXG4gICAgW3Byb2ZpbGVOYW1lSW5wdXQsIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBzZXR0aW5nc1xuICApO1xuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxuYWRkUG9zdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYWRkUG9zdE1vZGFsKTtcbn0pO1xuXG5wcm9maWxlQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5wcm9maWxlQXZhdGFyQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChwcm9maWxlQXZhdGFyRWRpdE1vZGFsKTtcbn0pO1xuXG5jbG9zZVBvc3RNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGFkZFBvc3RNb2RhbCk7XG59KTtcblxuY2xvc2Vab29tTW9kYWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChpbWFnZVpvb21Nb2RhbCk7XG59KTtcblxuY2xvc2VEZWxldGVNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKG1vZGFsQ29uZmlybURlbGV0ZSk7XG59KTtcblxuY2FuY2VsRGVsZXRlTW9kYWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChtb2RhbENvbmZpcm1EZWxldGUpO1xufSk7XG5cbnByb2ZpbGVBdmF0YXJTYXZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gIGhhbmRsZVByb2ZpbGVFZGl0QXZhdGFyKGV2dCk7XG59KTtcblxuY29uc3QgY2xvc2VNb2RhbEVzY2FwZUxpc3RlbmVyID0gKGV2ZW50KSA9PiB7XG4gIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuTW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgb3Blbk1vZGFscy5mb3JFYWNoKGNsb3NlTW9kYWwpO1xuICB9XG59O1xuXG5wcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcbmFkZE1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVBvc3RGb3JtU3VibWl0KTtcblxuLy9kZXN0cnVjdHVyZSBzZWNvbmQgaXRlbSBvZiAudGhlbigpXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGNhcmRDb250ZW50Q29udGFpbmVyLmFwcGVuZChnZXRDYXJkRWxlbWVudChpdGVtKSk7XG4gICAgfSk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuYXBpXG4gIC5nZXRVc2VySW5mbygpXG4gIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgIHByb2ZpbGVVc2VyTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgcHJvZmlsZVVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xuICAgIHByb2ZpbGVJbWFnZS5pZCA9IHVzZXJEYXRhLl9pZDtcblxuICAgIHByb2ZpbGVJbWFnZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7dXNlckRhdGEuYXZhdGFyfSlgO1xuXG4gICAgcHJvZmlsZUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBvcGVuTW9kYWwocHJvZmlsZUF2YXRhckVkaXRNb2RhbCk7XG4gICAgfSk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJleHBvcnQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fdG9rZW4gPSBwcm9jZXNzLmVudi5UT0tFTjtcbiAgICB0aGlzLl9iYXNlVXJsID0gXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiO1xuICAgIHRoaXMuX2hlYWRlcnMgPSB7XG4gICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcbiAgICAgIFwiQ29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH07XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIC8vY2FsbCBnZXQgdXNlciBpbmZvIGluIGFycmF5XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEFsbENhcmRzKCldKTtcbiAgfVxuXG4gIGdldEFsbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGxpbmsgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRpc2xpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cblxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cblxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG5cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlVXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXIgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidGV4dENvbnRlbnQiLCJlbmFibGVWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInNldEV2ZW50TGlzdGVuZXJzIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiYWRkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJzb21lIiwiaGFzSW52YWxpZElucHV0Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiaW5pdGlhbENhcmRzIiwiYXBpIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiX3Rva2VuIiwicHJvY2VzcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRBbGxDYXJkcyIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJjcmVhdGVDYXJkIiwiX3JlZiIsIm5hbWUiLCJsaW5rIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsImdldFVzZXJJbmZvIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJhYm91dCIsInVwZGF0ZVVzZXJBdmF0YXIiLCJhdmF0YXIiLCJwcm9maWxlQXZhdGFyRWRpdE1vZGFsIiwicHJvZmlsZUF2YXRhckNsb3NlQnV0dG9uIiwicHJvZmlsZUF2YXRhcklucHV0IiwicHJvZmlsZUF2YXRhclNhdmVCdXR0b24iLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZFBvc3RCdXR0b24iLCJwcm9maWxlSW1hZ2UiLCJlZGl0UHJvZmlsZU1vZGFsIiwiYWRkUG9zdE1vZGFsIiwiaW1hZ2Vab29tTW9kYWwiLCJwcm9maWxlQ2xvc2VCdXR0b24iLCJjbG9zZVBvc3RNb2RhbEJ1dHRvbiIsImNsb3NlWm9vbU1vZGFsQnV0dG9uIiwicHJvZmlsZU5hbWVJbnB1dCIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwicHJvZmlsZVVzZXJOYW1lIiwicHJvZmlsZVVzZXJEZXNjcmlwdGlvbiIsInByb2ZpbGVGb3JtIiwiYWRkTW9kYWxGb3JtIiwiYWRkTW9kYWxGb3JtTGluayIsImFkZE1vZGFsRm9ybUNhcHRpb24iLCJtb2RhbEltYWdlIiwibW9kYWxGb290ZXJDYXB0aW9uIiwibW9kYWxDb25maXJtRGVsZXRlIiwiY2xvc2VEZWxldGVNb2RhbEJ1dHRvbiIsImNhbmNlbERlbGV0ZU1vZGFsQnV0dG9uIiwibW9kYWxDb25maXJtRGVsZXRlQnRuIiwiY2FyZENvbnRlbnRDb250YWluZXIiLCJjbG9zZU1vZGFsTGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImNvbnRhaW5zIiwiY2xvc2VNb2RhbCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiY2xvc2VNb2RhbEVzY2FwZUxpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsInNyYyIsImFsdCIsIl9pZCIsImNhcmRIZWFydEJ0biIsImlzTGlrZWQiLCJjYXJkRWwiLCJ1cGRhdGVkQ2FyZCIsInRvZ2dsZSIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiaGFuZGxlTGlrZUJ1dHRvbiIsImlubmVyVGV4dCIsInNldFRpbWVvdXQiLCJjYXJkTmFtZSIsImluZGV4IiwiZmluZEluZGV4IiwiY2FyZCIsInRvU3BsaWNlZCIsImNvbmZpcm1DYXJkRGVsZXRlIiwibW9kYWxDYXB0aW9uIiwib3BlbkltYWdlTW9kYWwiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsImlucHV0Iiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJoYW5kbGVQcm9maWxlRWRpdEF2YXRhciIsImtleSIsInByb2ZpbGVEZXNjcmlwdGlvblNhdmVCdXR0b24iLCJuZXdDYXJkIiwib3duZXIiLCJ1bnNoaWZ0IiwicHJlcGVuZCIsImNhcmRzIiwiaXRlbSIsImFwcGVuZCIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==